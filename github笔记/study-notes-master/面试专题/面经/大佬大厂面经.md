# 大厂面经

## 蘑菇街

- 自我介绍一下吧

面试官您好，我是 xxx 大学软件工程的一名大三学生，从大一开始学习前端，产生了对编程的兴趣，大二开始接触 Java，大二下学期学了 ssm，springboot 等框架，也做了一些项目。后来发现基础很重要，于是从大三开始一直到现在，一直在对基础进行学习。比如：JVM，并发，操作系统，网络等。

- 看你的项目是分布式系统，那你的上游系统调用你的系统时可能会出现超时的问题，怎么处理

在我们的系统的话，一般有监控平台，请求超时会抛出异常，会触发企业微信邮件告警，开发人员知道以后去看一下对应的日志中的异常信息。查到具体是调用哪个接口出现的问题，这个接口里是否调用外部系统，定位问题是外部的还是内部的问题。

- 那如果你看到的日志就是很多请求，你认为这种是什么问题，在外部系统没有问题的情况下核心线程池被打满

我觉得可能是有人新改了一个功能并上线，不小心写了死循环导致的 CPU 飘高。

> PS：review code 的重要性

您说的线程池爆满的原因是可能一个接口中存在耗时的操作，导致请求这个接口的请求一直占用线程池，线程池被打满，从而导致后续来的其他接口的请求也会被影响。

这种情况一般可以服务降级、限流来处理。

- 在外部流量没有暴增的情况下，如果你的服务每隔半个小时会出现服务不可用的情况，这种怎么排查

它这个是突然每隔半个小时还是其他情况?

- 就是这一天 11 点出现了，以后每隔半小时就会有两分不可用，qps 都保持正常值

我猜这种情况一般出现在，定时任务同步一些数据到其他系统，由于网络的问题，那边服务慢的话就会导致一个超时，然后就会发生这个问题。

- 正常接受请求，也没有任务跑，你会往哪个方面想

那它会不会受到部署机器其他服务的影响呢。

- 没有

想了几分钟…..，这个目前还想不到其他的。

- 我可以给你个提示，往内存方面想

昂，立马 get 到点，是可能存在内存泄露吗？是不是由于存在内存泄露导致 full gc，gc 太频繁导致的。

- 对，那这种问题怎么排查解决

如果内存溢出的话，一般可能会有 OOM 抛出，JVM 可以设置参数在出现 OOM 时 dump 下内存的镜像，然后你可以利用一些分析工具，分析这个 dump 文件，有的工具直接可以给你一些优化建议，或者你可以找到哪个类的内存使用情况，找到内存泄露的点，去看代码。一般是 NIO 引起的，因为 Java 8 开启方法区使用的是元空间，不是永久代了。元空间是本地内存，不是堆内存，不受 JVM 管理，由操作系统管理，所以使用不当可能会出现内存泄露的问题。

- 好，那下一个问题，你那边用的是 dubbo 把

是

- 是借鉴 dubbo 开发的一个 rpc 框架吧

正常 Java 用的是 dubbo，之前是 php，为了 php 和 java 微服务之间的跨语言调用，实现了一个跨语言的 rpc，现在已经全部转为 Java 了，都用 dubbo 调用。而且微服务架构方面又做了改进，使用了 Service Mesh，面向云原生。

- dubbo 服务的启动、注册流程，说一下

首先，有个服务的提供者启动起来后，会先向服务注册中心注册服务，如果是 zk 的话，它就是在某个 dubbo 的目录下注册上下，其他消费者想调用的话，就从 zk 上把对应的提供者的 ip 地址啥的拉下来缓存起来。然后就可以调用了。

- 那提供服务的提供者 ip 更改了，消费者是如何动态感知服务提供者的改变呢

一般分布式注册服务可以动态感知。如果是 zk 的话，服务提供者在 zk 上注册服务时创建的是临时节点，如果服务 ip 更改了或者服务挂了，服务的调用者通过 zk 的 watch 机制可以监听到服务提供者目录下的节点增加、删除、修改事件。

- 你用到了很多队列，kafka、rabbitmq 了解吗

我现在这边用的是 nsq 和 kafka，kafka 一般是大数据那边离线处理一些东西，nsq 一般是告警信息，两个系统之间进行解耦，进行信息交互时，发消息到 nsq。区别的话，kafka 对大数据处理能力比较好，nsq 的话一般作为一个正常的消息队列，同步改异步就可以用 nsq。

- 既然 Kafka 可以处理大数据，那为什么不用 kafka，而用 nsq 呢？

这个问题我之前想过，问过我的 leader。kafka 一般是大数据那边流处理什么的，它那边一般都只接受 kafka 的消息，和大数据集成比较好。至于选 nsq 的话，它是结合当时的业务场景选择的，这个也没有选哪个好哪个坏。

- 那他当时选型的时候，为什么不用 kafka

因为 kafka 貌似对于延时消息等支持的不太好，事务这些，它虽然对大数据的处理的好，但是它也有缺漏的地方，它有它的专攻方向，比如：吞吐量方面，但是也有它的不足之处，就好比计算机中的摩尔定律。一般业务系统常需要一些延时消息就需要用 nsq 了。



根据我的项目问的一些问题

……



- 有数据库调优经验吗？对于数据库有多索引匹配时，有什么经验吗

这个匹配的话，比如：ABC 三个组合索引，必须要顺序执行，比如 A = 2，C =2 。这个时候就不会执行，因为它破坏了顺序性。

- 你说这种情况是完全用不到吗

是的，因为它不满足索引的最左匹配原则。

- 那比如说，我数据库有多个索引，A，B，BC，一个查询条件 A，B，C 都有，那一般怎么查看呢

这个一般的话是用 explain 去分析一下 sql 的执行计划，它会输出可能走的索引，真正走的索引，扫描的行数，额外的消耗（extra），用没用临时表等。

- 那它分析出来的索引就是数据库一定会用的索引吗

explain 分析出来的吗

- 或者说，你觉得它 explain 分析出来的就是最佳的索引吗

一般情况下最佳的，数据库会根据你的 sql，通过解析器生成对应的语法分析树，它对这个树进行一些规则的优化后，会生成一些查询计划，通过基于时间成本的分析算法选出一个尽可能是最佳的查询计划。这个具体合不合适很难说。

- 你没有遇到建的索引不好，导致走的索引是最差的情况吗

这个一般的话，可能是你对索引一无所知，导致一些索引的规则不去遵守，而且数据库索引的匹配规则很多，很容易走坑。如果你的业务一定要走你设置的那个索引，mysql 也可以通过设置强制走你设置的某个索引。

- 你对 Java8 了解吗

了解，因为我现在参与的项目就大量用了 Java8 的特性。比如：stream，lambda 表达式，时间 API 等。具体应用场景的话，比如你一个接口要返回 VO List 集合，而你数据库查出来的是 DO List 集合，这个时候你就可以用集合的 stream 去做这个转换。相比于传统的写法，代码会变的很简单和清爽。

- 流式编写代码的好处和坏处可以说一下嘛

好处的话，写代码的效率快了，看和很舒服。

坏处的话，流式性能不怎么好，并发情况很多的情况下才体现出好。

我觉得最主要的是，之前你自己写的话，就面向过程化了。流式的话，Java8 提倡的是面向函数式编程嘛。编程模型之前最开始是面向过程，然后面向对象，面向元编程，面向切面编程，面向函数式编程，以后 java9 的面向模块化编程。而且把过程封装在函数中，通过函数去转换数据的状态对于线程安全方面也有很大的好处。

- 如果数据库对一些记录存在热点更新操作，有大量的更新，怎么解决呢

一般可以利用多级缓存去解决。如果数据量太猛增的话，你用 redis 客户端访问 redis 服务端都访问不到，因为带宽被打满了嘛。这种情况可以提前去探测某个 key 是不是热点，然后在本地缓存操作。

- 你怎么即时同步数据给其他人呢

它会有一个算法提前探测某个 key 是否是热点，然后框架会帮你进行本地缓存的管理。

- 数据库有单热点，那你怎么解决

这种一般先做一个缓存，然后可以用消息队列削峰填谷。

- 操作缓存可能会超时，你怎么保证这个数据的正确性呢？因为你加了缓存呀

对对，这个数据库和缓存保持一致性比较难保证。而且大量数据访问更新，也不能加锁，因为数据库通过行锁保证线程并发安全问题。

- 我要你解决的就是行锁等待导致的性能被拉低的问题，用缓存也是可以的，但是不能保证 100% 的数据一致性，那我的业务场景就是想要 100% 的数据一致性，你现在有大概的解决思路吗

这个可以用多套数据库主从集群来解决吗？通过这种方式来提升数据库的写性能。让多个集群去抗。数据库中间件可以把流量分散到各个主从集群中的主库上。

- 可以，这算是一种解决方案，那还有其他办法吗

你打破这个行锁就行了

…… 我再想想。这个 ……

- 主要是单条记录引起的，它就是频繁更新引起的。

昂，这个是不是可以……… 我看 JDK 源码，频繁更新它一般是： HashMap 是非线程安全的，后来出现了线程安全版的 HashTable，但是它性能比较差，因为它直接就对整个 hash 表进行了加锁。后来出现了 CurrentHashMap，出现了分段锁，降低了锁的粒度，其实就是一种思想，你对一个热点数据的访问的话，就是分而治之，多去搞几个，均摊一下。难道是利用 hash 一致性算法把这些写请求，多分几张表。

- 差不多吧，思想就是分而治之，只要把单点数据拆分掉，让它变成多条数据，然后去更新多条数据，最后再合成一条。

嗯嗯。现在大数据一般也这样，大的搞不动就拆分。

- 从和你的对话来看，我觉得你基础也不错，基础我就不问了，我这边没有什么问题了，我看你这边，实习经历丰富，offer 收的也挺多。你有什么想问的

贵公司的技术栈，还有如果我进去以后所在的产品线。

面试官讲述了他们公司的技术栈和一些业务

面试官对我的一些职业规划的建议

多锻炼自己的技术思维 + 业务思维，可以往业务中台方向走。更好的支持别人的业务，技术主要服务于技术，要培养业务架构思维。





## 阿里

### 一面：40分钟左右

- 介绍项目经验（和简历上一样）
- 根据你的介绍对其中的知识点进行提问；中间还会提出一些问题，让你思考解决方案（比如缓存放在内存中，如果宕机怎么办？...）
- 今天在演练这样一个场景——假如所有缓存服务器都宕机，而且不能很快恢复，并且假设数据库服务器能够支撑，在代码中如何应对这样的情况？
- 之前的做法是在读缓存的地方捕获异常并写入日志，然后直接从数据库读取数据；在写缓存的地方捕获异常并写入日志，继续后续处理。这样看起来不错，虽然缓存服务器宕机，但程序可以继续工作，虽然速度慢一些，但不会让网站服务中断，然后只要把缓存服务器恢复即可。
- 但是如果缓存服务器宕机时，访问量很大，每一个操作缓存的地方都抛异常、写日志，这是两个开销很大的操作，大量的这样的操作会给Web服务器带来很大的压力。有没有更好的解决方法呢？
- 当操作缓存时抛出了第一个异常，我们就已经知道缓存服务器发生了故障。接下来对缓存的任何操作不仅没有必要，而且由此产生的异常会带来额外的开销、影响性能。只要我们通过一种方式在知道缓存服务器发生故障的第一时间通知后续缓存操作代码不要进行缓存操作，就能解决这个问题。
- 我们想到的一个解决方法是通过全局静态变量，该全局静态变量保存缓存服务器当前可用状态，只要有一个操作缓存的地方出现异常就将该变量置为不可用状态，并写日志、发通知。每一个操作缓存的地方在操作前先检查一下这个全局静态变量，一发现缓存服务器不可用，就放弃操作缓存，进入无缓存情况下的操作流程。当我们得知缓存服务器宕机后，先专心把缓存服务器恢复正常运行，然后更新一下这个全局静态变量即可。
- 这又是一个看起来不错的解决方法。但是全局静态变量只能在当前应用程序的当前进程中全局，无法在Web Farm（比如使用负载均衡，同一个应用程序运行于多台服务器上）与Web Garden（同一个应用程序运行于同一台服务器的多个进程中）的场景中全局。所以采用这个解决方法，缓存服务器宕机时，每个进程都要进行捕获异常、设置全局静态变量的操作，虽然不是最佳解决方法，但总比异常满天飞要好很多。还有一个更头疼的问题，就是在缓存服务器恢复正常后，如何将这些全局静态变量恢复为可用状态？无法代码进入每一个进程中进行操作，目前我们只想到一个解决方法——重启应用程序（如果是IIS，回收应用程序池）。
- 改进修改全局静态变量的方式，通过定时执行的代码检查缓存服务器的状态。如果缓存服务器不可用，将全局静态变量置为不可用状态；如果缓存服务器可用，并且全局静态变量的值为不可用状态，则将全局静态变量置为可用状态。

### 二面：25分钟左右

- equals实现方法，如果没看过，想想你会怎么实现
- hashmap与hashtable比较
- 设计模式了解哪些
- 观察者模式能说说吗
- TCP三次握手原理
- 你有什么想问的

### 三面：30分钟

- hashmap arraylist 原理
- concurrent包里的一些类了解吗，原理是什么
- 项目中印象最深刻的是哪个；然后针对项目提到的技术点进行提问
- 你有什么想问的

### 四面（大Boss面）：23分钟

- 自我介绍
- 系统如何提高并发性
- 学Java多久了
- Java基本类型有几种，列举下
- int和Integer的区别
- 有学过操作系统吗
- 操作系统里的内存碎片你怎么理解，有什么解决办法
- 你有什么想问的

### 五面（交叉大Boss面）：16分钟

- 自我介绍
- 你用什么语言比较多？
- 蜻蜓点水式地提问Java基础（简单一句话回答，还没有来得及详细描述就下一个问题了）：synchronize锁普通类和静态类的区别、ThreadLocal、Java8有用什么特性。。。
- 系统CPU比较高是什么原因？
- 3点15分时针和分针的角度是多少度
- 你有了解什么新的技术趋势吗
- 介绍下目前对什么技术了解
- redis有看过部分源码吗
- redis是单线程还是多线程的
- redis为什么是单线程的

### HR面：30分钟

- 介绍下能体现你的技术水平的实践/学习经历
- 你认为最能学到东西的实践是哪个？然后针对提到的技术点开始追问：异步怎么处理数据一致性？数据库怎么实现分布式事务？2PC的脑裂问题你有什么想法？。。。
- 你的未来职业规划是怎么样的
- 你对应聘的岗位/部门了解吗
- 你有什么想问的



## 字节跳动

### 远程第一场 11:00

1. 从输入网址到获得页面的网络请求过程【第一遍】
2. HTTP header
3. Redis了解吗？【不了解，结束】
4. MySQL引擎有什么？有什么差异？
5. Linux进程状态
6. Linux进程什么时候会变为等待？
7. 一个int数，一个线程写，多个线程修改，加不加锁有什么影响？如果是一个结构体呢？
8. 线程的栈在内存什么位置？
9. 算法题1：LRU cache （LeetCode 146）
10. 算法题2：一个有符号的有序数组，问这些数平方之后有多少个不重复的数？（双指针）
11. HashMap的底层实现

### 远程第二场 13:00

1. 讲一下你最得意的一个项目
2. 看你有个游戏项目，发布了吗？【没有，但是手机上有，运行展示】【面试前可展示的项目一定要准备好，要不就阻塞了】
3. 算法题：在一个长字符串中找一个子字符串是否存在，有，返回index，没有，返回-1。子字符串要求连续，但不在乎内部字符的顺序。（滑动窗口问题）
4. DNS解析过程【约等于第二遍】
5. 说一下你的优缺点

### 远程第三场 14:14

1. n个人，n个座位，每个人都有自己的座位，问每个人都不坐自己座位的坐法有多少种？（动态规划，解决重复子问题，两种情况讨论）
2. 从输入网址到获得页面的网络请求过程【第三遍，面试官真爱】
3. HTTP状态码
4. 你有一个网站项目，服务器是怎么弄的？
5. session和cookie有什么差异，分别什么时候用，在什么时候生成，长时cookie和短时cookie分别用在什么时候
6. 微信手机扫码登录电脑端发生了什么？
7. TCP三次握手，为什么不能两次握手，三次握手怎么解决了这个问题
8. fork实质是什么
9. 虚拟存储



## 京东

### 一面（基础面：约五十分钟）

1. 自我介绍，主要讲讲做了什么和擅长什么

2. springmvc和spring-boot区别

3. @Autowired的实现原理

4. Bean的默认作用范围是什么？其他的作用范围？

5. 索引是什么概念有什么作用？MySQL里主要有哪些索引结构？哈希索引和B+树索引比较？

6. Java线程池的原理？线程池有哪些？线程池工厂有哪些线程池类型，及其线程池参数是什么？

7. hashmap原理，处理哈希冲突用的哪种方法？

8. 还知道什么处理哈希冲突的方法？

9. Java GC机制？GC Roots有哪些？

10. Java怎么进行垃圾回收的？什么对象会进老年代？垃圾回收算法有哪些？为什么新生代使用复制算法？

11. HashMap的时间复杂度？HashMap中Hash冲突是怎么解决的？链表的上一级结构是什么？Java8中的HashMap有什么变化？红黑树需要比较大小才能进行插入，是依据什么进行比较的？其他Hash冲突解决方式？

12. hash和B+树的区别？分别应用于什么场景？哪个比较好？

13. 项目里有个数据安全的，aes和md5的区别？详细点


### 二面（问数据库较多：约五十分钟）

1. 自我介绍

2. 为什么MyISAM查询性能好？

3. 事务特性（acid）

4. 隔离级别

5. SQL慢查询的常见优化步骤？

6. 说下乐观锁，悲观锁（select for update），并写出sql实现

7. TCP协议的三次握手和四次挥手过程？

8. 用到过哪些rpc框架

9. 数据库连接池怎么实现

10. Java web过滤器的生命周期


### 三面（综合面，约五十分钟）

1. 自我介绍。

2. ConcurrentHashMap 在Java7和Java8中的区别？为什么Java8并发效率更好？什么情况下用HashMap，什么情况用ConcurrentHashMap？

3. 加锁有什么机制？

4. ThreadLocal？应用场景？

5. 数据库水平切分，垂直切分的设计思路和切分顺序

6. Redis如何解决key冲突

7. soa和微服务的区别？

8. 单机系统演变为分布式系统，会涉及到哪些技术的调整？请从前面负载到后端详细描述。

9. 设计一个秒杀系统？


### 四面：(HR面)

1. 你自己最大优势和劣势是什么
2. 平时遇见过什么样的挑战，怎么去克服的

3. 工作中遇见了技术解决不了的问题，你的应对思路？

4. 你的兴趣爱好？

5. 未来的职业规划是什么？